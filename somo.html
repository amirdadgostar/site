<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Øª Ø§Ù…Ù† P2P</title>
    <!-- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÙˆÙ†Øª Ùˆ Ø¢ÛŒÚ©ÙˆÙ† -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø§Ø¦Ù…ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø± -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

    <style>
        :root { --p: #0088cc; --bg: #e5ddd5; --me: #dcf8c6; --other: #fff; }
        * { box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .hide { display: none !important; }
        
        /* ÙØ±Ù… ÙˆØ±ÙˆØ¯ */
        #auth-screen { flex: 1; display: flex; justify-content: center; align-items: center; background: white; z-index: 100;}
        .card { padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 350px; text-align: center; }
        .inp { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; outline: none; }
        .btn { width: 100%; padding: 12px; background: var(--p); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* ØµÙØ­Ù‡ Ú†Øª */
        #chat-screen { display: flex; flex-direction: column; height: 100%; }
        header { background: var(--p); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        #status { font-size: 0.8rem; opacity: 0.8; }
        #typing-ind { font-size: 0.8rem; color: #ffeb3b; height: 15px; transition: 0.3s;}
        
        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; position: relative; word-wrap: break-word; font-size: 0.95rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1);}
        .me { background: var(--me); align-self: flex-end; border-bottom-right-radius: 0; }
        .other { background: var(--other); align-self: flex-start; border-bottom-left-radius: 0; }
        .ticks { font-size: 0.7rem; color: #888; float: left; margin-top: 5px; margin-right: 10px; }
        .ticks.read { color: #34b7f1; }
        
        .media-img { max-width: 100%; border-radius: 8px; margin-bottom: 5px; }

        .input-area { padding: 10px; background: #f0f0f0; display: flex; gap: 10px; align-items: center; }
        #msg-input { flex: 1; padding: 12px; border-radius: 20px; border: none; outline: none; }
        .icon-btn { background: none; border: none; font-size: 1.5rem; color: #555; cursor: pointer; display: flex;}
    </style>
</head>
<body>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øª Ù†Ø§Ù… -->
<div id="auth-screen">
    <div class="card" id="login-box">
        <h2>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú†Øª Ø§Ù…Ù†</h2><br>
        <input type="text" id="l-id" class="inp" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)">
        <input type="password" id="l-pass" class="inp" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
        <button class="btn" onclick="app.login()">ÙˆØ±ÙˆØ¯</button>
        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--p); cursor: pointer;" onclick="app.toggleAuth()">Ø«Ø¨Øª Ù†Ø§Ù… Ú©Ù†ÛŒØ¯</p>
    </div>
    
    <div class="card hide" id="reg-box">
        <h2>Ø«Ø¨Øª Ù†Ø§Ù…</h2><br>
        <input type="text" id="r-name" class="inp" placeholder="Ù†Ø§Ù… Ø´Ù…Ø§">
        <input type="text" id="r-id" class="inp" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)">
        <input type="password" id="r-pass" class="inp" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
        <button class="btn" onclick="app.register()">Ø«Ø¨Øª Ù†Ø§Ù…</button>
        <p style="margin-top: 15px; font-size: 0.9rem; color: var(--p); cursor: pointer;" onclick="app.toggleAuth()">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆØ±ÙˆØ¯</p>
    </div>
</div>

<!-- ØµÙØ­Ù‡ Ú†Øª -->
<div id="chat-screen" class="hide">
    <header>
        <div>
            <div id="chat-with" style="font-weight: bold; font-size: 1.1rem;">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...</div>
            <div id="status">Ø¢ÙÙ„Ø§ÛŒÙ† ğŸ”´</div>
            <div id="typing-ind"></div>
        </div>
        <button class="icon-btn" onclick="app.copyMyLink()" style="color:white" title="Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú© Ù…Ù†"><i class="ph ph-link"></i></button>
    </header>

    <div id="chat-box"></div>

    <div class="input-area">
        <label class="icon-btn">
            <i class="ph ph-paperclip"></i>
            <input type="file" id="file-input" class="hide" onchange="app.sendFile(this)">
        </label>
        <input type="text" id="msg-input" placeholder="Ù¾ÛŒØ§Ù… Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." oninput="app.sendTyping('text')" onkeypress="if(event.key==='Enter') app.sendMsg()">
        <button class="icon-btn" onclick="app.sendMsg()" style="color: var(--p);"><i class="ph-fill ph-paper-plane-right"></i></button>
    </div>
</div>

<script>
    // ** Ø§ÛŒÙ†Ø¬Ø§ Ø¢Ø¯Ø±Ø³ Web App Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ **
    const API_URL = 'https://script.google.com/macros/s/AKfycbzUs7wbZvp4MRoC4twyvXMAZ_vmhX2rTeZCLXhor2f7VoBeWsV4QNyct3bwrW1svmunVQ/exec';

    const app = {
        me: null,
        targetUser: null,
        peer: null,
        channel: null,
        signalingTimer: null,
        isOnline: false,
        typingTimeout: null,
        messages: [], // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø±Ù…
        
        init: async function() {
            // Ø®ÙˆØ§Ù†Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø­Ø§ÙØ¸Ù‡
            const savedUser = await localforage.getItem('user');
            if (savedUser) {
                this.me = savedUser;
                document.getElementById('auth-screen').classList.add('hide');
                this.checkTarget();
            }

            // Ú†Ú© Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú© Ú©Ù‡ Ø¢ÛŒØ§ Ø¢ÛŒØ¯ÛŒ Ú©Ø³ÛŒ ØªÙˆØ´ Ù‡Ø³ØªØŸ (Ù…Ø«Ù„Ø§ ?u=ali)
            const urlParams = new URLSearchParams(window.location.search);
            const u = urlParams.get('u');
            if(u) this.targetUser = u.toLowerCase();
        },

        toggleAuth: () => {
            document.getElementById('login-box').classList.toggle('hide');
            document.getElementById('reg-box').classList.toggle('hide');
        },

        callAPI: async function(act, payload) {
            const res = await fetch(API_URL, {
                method: 'POST', body: JSON.stringify({action: act, payload: payload})
            });
            return await res.json();
        },

        login: async function() {
            const id = document.getElementById('l-id').value;
            const pass = document.getElementById('l-pass').value;
            if(!id || !pass) return alert('Ù¾Ø± Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒØ³Øª');
            
            const res = await this.callAPI('login', {id, pass});
            if(res.status === 'success') {
                this.me = res.user;
                await localforage.setItem('user', this.me);
                document.getElementById('auth-screen').classList.add('hide');
                this.checkTarget();
            } else alert(res.msg);
        },

        register: async function() {
            const name = document.getElementById('r-name').value;
            const id = document.getElementById('r-id').value;
            const pass = document.getElementById('r-pass').value;
            
            const res = await this.callAPI('register', {name, id, pass});
            if(res.status === 'success') {
                this.me = res.user;
                await localforage.setItem('user', this.me);
                document.getElementById('auth-screen').classList.add('hide');
                this.checkTarget();
            } else alert(res.msg);
        },

        copyMyLink: function() {
            const link = location.origin + location.pathname + '?u=' + this.me.id;
            navigator.clipboard.writeText(link);
            alert('Ù„ÛŒÙ†Ú© Ø§Ø®ØªØµØ§ØµÛŒ Ø´Ù…Ø§ Ú©Ù¾ÛŒ Ø´Ø¯! Ø¢Ù† Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØªØ§Ù† Ø¨ÙØ±Ø³ØªÛŒØ¯.');
        },

        checkTarget: async function() {
            if(!this.targetUser) {
                document.getElementById('chat-screen').classList.remove('hide');
                document.getElementById('chat-with').innerText = 'Ø¨Ù‡ ØµÙØ­Ù‡ Ø®ÙˆØ¯ØªØ§Ù† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯';
                document.getElementById('status').innerText = 'Ù„ÛŒÙ†Ú© Ø®ÙˆØ¯ Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø¯ÙˆØ³ØªØ§Ù† Ø¨Ø¯Ù‡ÛŒØ¯';
                return;
            }
            document.getElementById('chat-screen').classList.remove('hide');
            document.getElementById('chat-with').innerText = 'Ú†Øª Ø¨Ø§: ' + this.targetUser;
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú†Øª Ø§Ø² Ø­Ø§ÙØ¸Ù‡ Ú¯ÙˆØ´ÛŒ
            this.messages = await localforage.getItem('chat_' + this.targetUser) || [];
            this.renderChat();
            
            // Ø´Ø±ÙˆØ¹ Ø§ØªØµØ§Ù„ P2P
            this.initWebRTC();
        },

        // ==========================================
        // Ø¬Ø§Ø¯ÙˆÛŒ WebRTC (Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ…)
        // ==========================================
        initWebRTC: function() {
            this.peer = new RTCPeerConnection({ iceServers: [{urls: 'stun:stun.l.google.com:19302'}] });

            // Ø³Ø§Ø®Øª Ú©Ø§Ù†Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ØªÙ† Ùˆ ÙØ§ÛŒÙ„
            this.channel = this.peer.createDataChannel('chat');
            this.setupChannel(this.channel);

            // Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ù†Ø§Ù„ Ø§Ø² Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„
            this.peer.ondatachannel = (event) => {
                this.setupChannel(event.channel);
            };

            // Ø§Ø±Ø³Ø§Ù„ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ (ICE) Ø¨Ù‡ Ø³Ø±ÙˆØ± Ú¯ÙˆÚ¯Ù„ ØªØ§ Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„ Ù¾ÛŒØ¯Ø§ Ú©Ù†Ø¯
            this.peer.onicecandidate = (e) => {
                if (e.candidate) {
                    this.callAPI('sendSignal', {to: this.targetUser, from: this.me.id, type: 'ice', data: e.candidate});
                }
            };

            // Ù…Ù† Ø´Ø±ÙˆØ¹ Ú©Ù†Ù†Ø¯Ù‡ Ù‡Ø³ØªÙ… (Offer Ù…ÛŒâ€ŒØ³Ø§Ø²Ù…)
            this.peer.createOffer().then(offer => {
                this.peer.setLocalDescription(offer);
                this.callAPI('sendSignal', {to: this.targetUser, from: this.me.id, type: 'offer', data: offer});
            });

            // Ù‡Ø± 3 Ø«Ø§Ù†ÛŒÙ‡ Ø§Ø² Ú¯ÙˆÚ¯Ù„ Ù…ÛŒâ€ŒÙ¾Ø±Ø³Ù…: "Ø¢ÛŒØ§ Ú©Ø³ÛŒ Ù…Ø³ÛŒØ± ÛŒØ§ Ú©Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ù† ÙØ±Ø³ØªØ§Ø¯Ù‡ØŸ"
            this.signalingTimer = setInterval(() => this.pollSignals(), 3000);
        },

        setupChannel: function(channel) {
            channel.onopen = () => {
                this.isOnline = true;
                document.getElementById('status').innerText = 'Ø¢Ù†Ù„Ø§ÛŒÙ† ğŸŸ¢';
                clearInterval(this.signalingTimer); // Ø¯ÛŒÚ¯Ù‡ Ø³Ø±ÙˆØ± Ú¯ÙˆÚ¯Ù„ Ø±Ùˆ ÙˆÙ„ Ù…ÛŒÚ©Ù†ÛŒÙ…! Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ø´Ø¯!
                this.syncPendingMessages(); // Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØªÙˆ ØµÙ Ø±Ùˆ Ù…ÛŒÙØ±Ø³ØªÙ…
            };
            
            channel.onclose = () => {
                this.isOnline = false;
                document.getElementById('status').innerText = 'Ø¢ÙÙ„Ø§ÛŒÙ† ğŸ”´ (Ø¯Ø± Ø­Ø§Ù„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...)';
                this.initWebRTC(); // ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø§ØªØµØ§Ù„
            };

            channel.onmessage = (e) => {
                const data = JSON.parse(e.data);
                
                // Ù‡Ù†Ø¯Ù„ Ú©Ø±Ø¯Ù† ØªÛŒÚ©â€ŒÙ‡Ø§ Ùˆ Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†
                if (data.sys) {
                    if (data.act === 'typing') this.showTyping(data.mode);
                    if (data.act === 'read') this.markAsRead(data.msgId);
                    if (data.act === 'delivered') this.markAsDelivered(data.msgId);
                    return;
                }

                // Ù¾ÛŒØ§Ù… ÛŒØ§ ÙØ§ÛŒÙ„ ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯
                data.status = 'read'; // Ú†ÙˆÙ† Ù‡Ù…ÙˆÙ† Ù„Ø­Ø¸Ù‡ Ø¯ÛŒØ¯ÛŒÙ…
                this.messages.push(data);
                this.saveDb();
                this.renderChat();
                
                // Ø§Ø±Ø³Ø§Ù„ ØªÛŒÚ© Ø¯ÙˆØªØ§ (Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯) Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡
                this.channel.send(JSON.stringify({sys: true, act: 'read', msgId: data.id}));
            };
        },

        pollSignals: async function() {
            const res = await this.callAPI('getSignals', {me: this.me.id});
            if (!res.signals) return;

            for (let sig of res.signals) {
                if (sig.from !== this.targetUser) continue;

                if (sig.type === 'offer') {
                    await this.peer.setRemoteDescription(new RTCSessionDescription(sig.data));
                    const answer = await this.peer.createAnswer();
                    await this.peer.setLocalDescription(answer);
                    this.callAPI('sendSignal', {to: this.targetUser, from: this.me.id, type: 'answer', data: answer});
                } 
                else if (sig.type === 'answer') {
                    await this.peer.setRemoteDescription(new RTCSessionDescription(sig.data));
                } 
                else if (sig.type === 'ice') {
                    await this.peer.addIceCandidate(new RTCIceCandidate(sig.data));
                }
            }
        },

        // ==========================================
        // Ø¹Ù…Ù„ÛŒØ§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
        // ==========================================
        sendMsg: function(textParam, mediaObj) {
            const input = document.getElementById('msg-input');
            const text = textParam || input.value.trim();
            if (!text && !mediaObj) return;

            const msg = {
                id: Date.now().toString(),
                sender: this.me.id,
                text: text,
                media: mediaObj || null, // {type: 'image', data: 'base64...'}
                time: Date.now(),
                status: 'wait' // wait, sent, delivered, read
            };

            this.messages.push(msg);
            this.saveDb();
            this.renderChat();
            input.value = '';

            this.dispatchMessage(msg);
        },

        dispatchMessage: function(msg) {
            if (this.isOnline && this.channel.readyState === 'open') {
                try {
                    this.channel.send(JSON.stringify(msg));
                    msg.status = 'sent'; // ÛŒÚ© ØªÛŒÚ©
                    this.saveDb();
                    this.renderChat();
                } catch(e) {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ…', e);
                }
            }
        },

        syncPendingMessages: function() {
            // ÙˆÙ‚ØªÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´Ø¯ÛŒÙ…ØŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø±Ùˆ Ù…ÛŒÙØ±Ø³ØªÛŒÙ…
            this.messages.forEach(m => {
                if (m.sender === this.me.id && m.status === 'wait') {
                    this.dispatchMessage(m);
                }
            });
        },

        sendFile: function(input) {
            const file = input.files[0];
            if (!file) return;
            if (file.size > 2 * 1024 * 1024) return alert('Ø¨Ø±Ø§ÛŒ Ø¯Ù…Ùˆ Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø²ÛŒØ± 2 Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯.');
            
            this.sendTyping('file'); // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„

            const reader = new FileReader();
            reader.onload = (e) => {
                let type = 'file';
                if(file.type.startsWith('image')) type = 'image';
                else if(file.type.startsWith('video')) type = 'video';
                else if(file.type.startsWith('audio')) type = 'audio';

                this.sendMsg('', {type: type, data: e.target.result, name: file.name});
            };
            reader.readAsDataURL(file);
        },

        sendTyping: function(mode) {
            if (this.isOnline && this.channel.readyState === 'open') {
                this.channel.send(JSON.stringify({sys: true, act: 'typing', mode: mode}));
            }
        },

        showTyping: function(mode) {
            const ind = document.getElementById('typing-ind');
            let txt = 'Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†...';
            if(mode === 'image') txt = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¹Ú©Ø³...';
            if(mode === 'audio') txt = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ ØµØ¯Ø§...';
            if(mode === 'file') txt = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„...';
            
            ind.innerText = txt;
            clearTimeout(this.typingTimeout);
            this.typingTimeout = setTimeout(() => { ind.innerText = ''; }, 2000);
        },

        markAsRead: function(msgId) {
            const m = this.messages.find(x => x.id === msgId);
            if(m) { m.status = 'read'; this.saveDb(); this.renderChat(); }
        },

        saveDb: function() {
            localforage.setItem('chat_' + this.targetUser, this.messages);
        },

        renderChat: function() {
            const box = document.getElementById('chat-box');
            let html = '';
            
            this.messages.forEach(m => {
                const isMe = m.sender === this.me.id;
                let ticks = '';
                if(isMe) {
                    if(m.status === 'wait') ticks = '<i class="ph ph-clock"></i>';
                    else if(m.status === 'sent' || m.status === 'delivered') ticks = '<i class="ph ph-check"></i>';
                    else if(m.status === 'read') ticks = '<i class="ph-fill ph-checks"></i>';
                }

                let mediaHtml = '';
                if (m.media) {
                    if(m.media.type === 'image') mediaHtml = `<img src="${m.media.data}" class="media-img">`;
                    else if(m.media.type === 'video') mediaHtml = `<video src="${m.media.data}" controls class="media-img"></video>`;
                    else if(m.media.type === 'audio') mediaHtml = `<audio src="${m.media.data}" controls style="width:100%"></audio>`;
                    else mediaHtml = `<a href="${m.media.data}" download="${m.media.name}">ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ (${m.media.name})</a>`;
                }

                html += `
                <div class="msg ${isMe ? 'me' : 'other'}">
                    ${mediaHtml}
                    ${m.text ? `<div>${m.text}</div>` : ''}
                    <div class="ticks ${m.status}">${ticks}</div>
                    <div style="font-size:0.6rem; color:#888; text-align:right; margin-top:5px;">
                        ${new Date(m.time).toLocaleTimeString('fa-IR', {hour:'2-digit', minute:'2-digit'})}
                    </div>
                </div>`;
            });
            
            box.innerHTML = html;
            box.scrollTop = box.scrollHeight; // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
        }
    };

    app.init();
</script>
</body>
</html>
