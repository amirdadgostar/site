<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل کاربری پروژه</title>
    <style>
        /* 
         * ADVANCED DESIGN SYSTEM V2
         * Formal, professional aesthetic with enhanced UX and responsiveness.
         */
        :root {
            /* Color Palette - Refined for a more formal tone */
            --primary-hue: 225;
            --primary-saturation: 75%;
            --primary-lightness: 55%;
            --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
            --primary-dark: hsl(var(--primary-hue), var(--primary-saturation), 45%);
            --primary-light: hsl(var(--primary-hue), var(--primary-saturation), 96%);
            
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
            --danger: #ef4444;

            /* Greyscale Palette */
            --text-dark: #111827;
            --text-light: #4b5563;
            --text-on-dark: #e5e7eb;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --border: #e2e8f0;

            /* Typography */
            --font-family: 'Tahoma', 'Vazirmatn', sans-serif;
            --fs-base: 16px;
            --fs-sm: 0.875rem; /* 14px */
            --fs-xs: 0.75rem;  /* 12px */
            --fs-lg: 1.125rem; /* 18px */
            --fs-xl: 1.5rem;   /* 24px */
            
            /* Spacing & Sizing */
            --spacing-2: 0.5rem;
            --spacing-3: 0.75rem;
            --spacing-4: 1rem;
            --spacing-6: 1.5rem;
            --spacing-8: 2rem;
            
            /* Borders & Shadows (Enhanced for 3D effect) */
            --border-radius-md: 0.75rem; /* More curved */
            --border-radius-lg: 1rem;
            --soft-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -2px rgba(0, 0, 0, 0.04);
            --medium-shadow: 0 10px 15px -3px rgba(17, 24, 39, 0.06), 0 4px 6px -4px rgba(17, 24, 39, 0.06);

            /* Transitions */
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Base & Reset */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: var(--fs-base); scroll-behavior: smooth; }
        body { 
            background-color: var(--bg); 
            color: var(--text-dark); 
            font-family: var(--font-family);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
            padding: var(--spacing-4);
        }
        
        /* Animation Keyframes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* Container */
        .container { width: 100%; max-width: 850px; animation: fadeIn 0.8s var(--transition-medium); }
        
        /* LOGIN SECTION STYLES */
        #loginSection {
            background: var(--card-bg);
            padding: var(--spacing-6);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--medium-shadow);
            border: 1px solid var(--border);
            animation: slideUp 0.6s var(--transition-medium) backwards;
        }
        .login-header { text-align: center; margin-bottom: var(--spacing-6); }
        .login-header h1 { font-size: var(--fs-xl); font-weight: 700; margin-bottom: var(--spacing-2); }
        .login-header p { color: var(--text-light); font-size: var(--fs-base); }

        .form-group { margin-bottom: var(--spacing-4); position: relative; }
        .form-group label { display: block; margin-bottom: var(--spacing-2); font-weight: 600; font-size: var(--fs-sm); }
        .form-group input {
            width: 100%;
            padding: 14px 45px 14px 14px; /* Increased padding */
            border: 1px solid var(--border);
            border-radius: var(--border-radius-md);
            font-size: var(--fs-base);
            transition: var(--transition-fast);
            background-color: #fff;
        }
        .form-group:focus-within {
            box-shadow: 0 0 0 3px hsla(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.3);
            border-radius: var(--border-radius-md);
        }
        .form-group input:focus { outline: none; border-color: var(--primary); }
        .input-icon {
            position: absolute;
            top: 43px;
            right: 14px;
            color: var(--text-light);
            pointer-events: none;
        }
        #password-toggle-icon {
            left: 14px;
            right: auto;
            pointer-events: all;
            cursor: pointer;
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: var(--transition-medium);
            font-size: var(--fs-base);
            width: 100%;
            display: flex; align-items: center; justify-content: center; gap: var(--spacing-2);
        }
        .btn-primary { background-color: var(--primary); box-shadow: var(--soft-shadow); }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); transform: translateY(-2px); box-shadow: var(--medium-shadow); }
        .btn:disabled { background-color: var(--text-light); cursor: not-allowed; }

        /* DASHBOARD SECTION STYLES */
        #dashboardSection { display: none; animation: fadeIn 0.5s; }
        .card {
            background: var(--card-bg);
            padding: var(--spacing-6);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--medium-shadow);
            margin-bottom: var(--spacing-6);
            border: 1px solid var(--border);
            animation: slideUp 0.5s var(--transition-medium) backwards;
            transition: var(--transition-medium);
        }
        .card:hover { transform: translateY(-3px); box-shadow: 0 20px 25px -5px rgba(17,24,39,0.07), 0 8px 10px -6px rgba(17,24,39,0.07); }
        .card:nth-child(2) { animation-delay: 0.1s; }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-6); padding-bottom: var(--spacing-4); border-bottom: 1px solid var(--border); }
        .card-header h2 { margin: 0; font-size: var(--fs-lg); display: flex; align-items: center; gap: var(--spacing-3); }
        .card-header h2 svg { color: var(--primary); }
        .logout-btn { background: none; border: 1px solid var(--danger); color: var(--danger); padding: var(--spacing-2) var(--spacing-3); font-size: var(--fs-sm); border-radius: var(--border-radius-md); cursor: pointer; display: flex; align-items: center; gap: var(--spacing-2); transition: var(--transition-fast); }
        .logout-btn:hover { background-color: hsla(355, 80%, 60%, 0.1); }

        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-4); }
        .info-item { background: var(--bg); padding: var(--spacing-4); border-radius: var(--border-radius-md); border: 1px solid var(--border); display: flex; gap: var(--spacing-3); align-items: flex-start; }
        .info-item .icon { color: var(--primary); flex-shrink: 0; }
        .info-item strong { display: block; color: var(--text-light); font-size: var(--fs-sm); margin-bottom: var(--spacing-1); }
        .info-item span { font-size: var(--fs-sm); word-break: break-all; }
        .info-item a { color: var(--primary); text-decoration: none; font-weight: bold; }
        .info-item a:hover { text-decoration: underline; }
        .full-width { grid-column: 1 / -1; }
        
        .badge { display: inline-block; padding: 4px 12px; border-radius: 99px; font-size: var(--fs-xs); font-weight: bold; color: white; text-transform: uppercase; }
        .badge-pay-1 { background-color: var(--warning); }
        .badge-pay-2 { background-color: var(--success); }
        .badge-status-1 { background-color: var(--warning); }
        .badge-status-2 { background-color: var(--info); }
        .badge-status-3 { background-color: var(--success); }
        
        /* Conditional Content: Locked Message */
        #projectDetailsSection { display: none; }
        #lockedContentMessage { background: var(--primary-light); color: var(--primary-dark); padding: var(--spacing-6); border-radius: var(--border-radius-md); border: 1px solid hsl(var(--primary-hue), var(--primary-saturation), 85%); font-size: var(--fs-sm); text-align: center; display: flex; flex-direction: column; align-items: center; gap: var(--spacing-4); }
        #lockedContentMessage svg { width: 40px; height: 40px; }
        
        .code-block { background: #1e293b; color: var(--text-on-dark); padding: var(--spacing-4); border-radius: var(--border-radius-md); font-family: 'Consolas', 'Menlo', monospace; white-space: pre-wrap; word-wrap: break-word; font-size: var(--fs-sm); border: 1px solid #334155; max-height: 200px; overflow-y: auto; }
        
        /* Loader Spinner */
        .spinner { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* MODERN ALERT MODAL STYLES */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: flex; justify-content: center; align-items: center;
            padding: var(--spacing-4);
            opacity: 0; visibility: hidden;
            transition: var(--transition-medium);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-box {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--medium-shadow);
            padding: var(--spacing-6);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: modalFadeIn 0.3s var(--transition-medium) backwards;
        }
        #modal-icon { margin-bottom: var(--spacing-4); }
        #modal-text { font-size: var(--fs-base); color: var(--text-light); line-height: 1.6; margin-bottom: var(--spacing-6); }
        .modal-btn { width: auto; min-width: 100px; }
        
        /* RESPONSIVENESS */
        @media (max-width: 600px) {
            body { padding: var(--spacing-2); }
            #loginSection { padding: var(--spacing-4); }
            .card { padding: var(--spacing-4); }
            .card-header h2 { font-size: 1.1rem; }
            .info-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Login Form -->
        <section id="loginSection">
            <div class="login-header">
                <h1>ورود به پنل کاربری</h1>
                <p>برای مشاهده وضعیت پروژه خود، لطفا وارد شوید.</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">ایمیل (نام کاربری)</label>
                    <div class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z"/></svg>
                    </div>
                    <input type="email" id="email" required placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label for="password">رمز عبور</label>
                    <div class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/></svg>
                    </div>
                    <div class="input-icon" id="password-toggle-icon">
                        <!-- Eye icons will be injected here by JS -->
                    </div>
                    <input type="password" id="password" required placeholder="••••••••">
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn">
                    ورود به داشبورد
                    <div class="spinner"></div>
                </button>
            </form>
        </section>

        <!-- User Dashboard -->
        <section id="dashboardSection">
            <!-- Cards will be populated here as before -->
        </section>
    </div>
    
    <!-- Modern Alert Modal -->
    <div class="modal-overlay" id="modern-alert">
        <div class="modal-box">
            <div id="modal-icon"></div>
            <p id="modal-text"></p>
            <button class="btn btn-primary modal-btn" onclick="closeModernAlert()">متوجه شدم</button>
        </div>
    </div>

    <script>
        // JAVASCRIPT LOGIC IS PRESERVED AND ENHANCED, NOT REPLACED.
        const API_URL = "https://script.google.com/macros/s/AKfycbwAN_TRwVknMCc-x05ug0L1wS1O8HsthawYEb4iLeMPCla_Rpm-U46rlBthq1Pt9w56/exec";
        
        const loginSection = document.getElementById('loginSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginBtn = document.getElementById('loginBtn');
        const spinner = loginBtn.querySelector('.spinner');
        const passwordInput = document.getElementById('password');
        const passwordToggle = document.getElementById('password-toggle-icon');

        // --- SVG Icons for dynamic use ---
        const eyeIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg>`;
        const eyeSlashIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="m10.79 12.912-1.614-1.615a3.5 3.5 0 0 1-4.474-4.474l-2.06-2.06C.938 6.278 0 8 0 8s3 5.5 8 5.5a7.029 7.029 0 0 0 2.79-.588zM5.21 3.088A7.028 7.028 0 0 1 8 2.5c5 0 8 5.5 8 5.5s-.939 1.721-2.641 3.238l-2.062-2.062a3.5 3.5 0 0 0-4.474-4.474L5.21 3.089z"/><path d="M5.525 7.646a2.5 2.5 0 0 0 2.829 2.829l-2.83-2.829zm4.95.708-2.829-2.83a2.5 2.5 0 0 1 2.829 2.829zm3.171 6-12-12 .708-.708 12 12-.708.708z"/></svg>`;
        const errorIcon = `<svg id="modal-icon-svg" xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="var(--danger)"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>`;
        
        // --- NEW: Session Persistence Logic ---
        window.onload = () => {
            const savedUser = localStorage.getItem('projectUser');
            if (savedUser) {
                const { email, password } = JSON.parse(savedUser);
                document.getElementById('email').value = email;
                document.getElementById('password').value = password;
                document.querySelector('.login-header p').textContent = 'در حال ورود خودکار...';
                loginUser(email, password);
            }
        };

        // --- NEW: Password Toggle Visibility ---
        passwordToggle.innerHTML = eyeIcon;
        passwordToggle.addEventListener('click', () => {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordToggle.innerHTML = eyeSlashIcon;
            } else {
                passwordInput.type = 'password';
                passwordToggle.innerHTML = eyeIcon;
            }
        });

        // Refactored Login Logic
        async function loginUser(email, password, saveSession = false) {
            loginBtn.disabled = true;
            spinner.style.display = 'block';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'userLogin', email, password })
                });
                const resData = await response.json();

                if (resData.success) {
                    if (saveSession) {
                        localStorage.setItem('projectUser', JSON.stringify({ email, password }));
                    }
                    displayDashboard(resData.data);
                } else {
                    localStorage.removeItem('projectUser'); // Clear failed login
                    document.querySelector('.login-header p').textContent = 'برای مشاهده وضعیت پروژه خود، لطفا وارد شوید.';
                    showModernAlert(resData.error);
                }
            } catch (error) {
                localStorage.removeItem('projectUser');
                document.querySelector('.login-header p').textContent = 'برای مشاهده وضعیت پروژه خود، لطفا وارد شوید.';
                showModernAlert("خطای ارتباط با سرور. لطفاً اتصال اینترنت خود را بررسی کنید.");
            }
            
            loginBtn.disabled = false;
            spinner.style.display = 'none';
        }

        // Original Login form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            loginUser(email, password, true); // Save session on manual login
        });
        
        // This function now generates the HTML dynamically
        function displayDashboard(data) {
            loginSection.style.display = 'none';
            
            const dashboardHTML = `
            <div class="card">
                <div class="card-header">
                    <h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L8.707 1.5z"/><path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6z"/></svg>
                        داشبورد پروژه
                    </h2>
                    <button class="logout-btn" onclick="logout()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/><path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/></svg>
                        خروج
                    </button>
                </div>
                <div class="info-grid">
                    <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></div><div><strong>ایمیل</strong><span>${data.email}</span></div></div>
                    <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div><div><strong>تاریخ ثبت</strong><span>${data.date}</span></div></div>
                    <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div><div><strong>وضعیت پرداخت</strong><span class="badge ${getPaymentStatus(data.paymentStatus).class}">${getPaymentStatus(data.paymentStatus).text}</span></div></div>
                    <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 12c0-5.25-4.25-9.5-9.5-9.5S2.5 6.75 2.5 12s4.25 9.5 9.5 9.5s9.5-4.25 9.5-9.5z"></path><polyline points="22,12 12,12 12,2"></polyline></svg></div><div><strong>وضعیت پروژه</strong><span class="badge ${getOrderStatus(data.orderStatus).class}">${getOrderStatus(data.orderStatus).text}</span></div></div>
                    <div class="info-item full-width"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><div><strong>دستورات اولیه شما</strong><span style="line-height: 1.6;">${data.instructions}</span></div></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                     <h2>
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
                        اطلاعات و فایل‌های نهایی پروژه
                    </h2>
                </div>
                ${data.projectDetails ? getProjectDetailsHTML(data.projectDetails) : getLockedContentHTML()}
            </div>`;
            
            dashboardSection.innerHTML = dashboardHTML;
            dashboardSection.style.display = 'block';
        }

        // --- Helper functions for translation (UNCHANGED) ---
        function getPaymentStatus(status) { if (status == 1) return { text: 'قسط اول پرداخت شده', class: 'badge-pay-1' }; if (status == 2) return { text: 'تسویه کامل انجام شده', class: 'badge-pay-2' }; return { text: 'نامشخص', class: '' }; }
        function getOrderStatus(status) { if (status == 1) return { text: 'ثبت اولیه', class: 'badge-status-1' }; if (status == 2) return { text: 'در حال انجام', class: 'badge-status-2' }; if (status == 3) return { text: 'تکمیل شده', class: 'badge-status-3' }; return { text: 'نامشخص', class: '' }; }
        
        // --- NEW: Helper functions for generating dynamic HTML ---
        function getLockedContentHTML() {
            return `<div id="lockedContentMessage">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" /></svg>
                        اطلاعات پروژه، فایل‌ها و سورس‌کدها پس از <strong>پرداخت قسط دوم</strong> و <strong>تکمیل نهایی پروژه</strong> در این بخش قابل مشاهده خواهند بود.
                    </div>`;
        }
        
        function getProjectDetailsHTML(details) {
            const siteUrl = details.siteUrl.startsWith('http') ? details.siteUrl : 'http://' + details.siteUrl;
            // Using a function to escape HTML to prevent XSS from sheet data
            const escape = (str) => str.replace(/[&<>"']/g, (match) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[match]);
            
            return `<div id="projectDetailsSection" style="display: block;">
                        <p style="color: var(--text-light); font-size: var(--fs-sm); margin-bottom: var(--spacing-6);">پروژه شما با موفقیت تکمیل شده است. در زیر می‌توانید به تمام اطلاعات و سورس‌کدهای مربوطه دسترسی داشته باشید.</p>
                        <div class="info-grid">
                            <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div><div><strong>ایمیل اکانت</strong><span>${escape(details.accountEmail)}</span></div></div>
                            <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></div><div><strong>رمز عبور اکانت</strong><span>${escape(details.accountPassword)}</span></div></div>
                            <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div><div><strong>نام کاربری GitHub</strong><span>${escape(details.githubUser)}</span></div></div>
                            <div class="info-item"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg></div><div><strong>آدرس نهایی سایت</strong><span><a href="${siteUrl}" target="_blank">${escape(details.siteUrl)}</a></span></div></div>
                            <div class="info-item full-width"><div><strong>کد HTML</strong><div class="code-block">${escape(details.htmlCode)}</div></div></div>
                            <div class="info-item full-width"><div><strong>کد CSS</strong><div class="code-block">${escape(details.cssCode)}</div></div></div>
                            <div class="info-item full-width"><div><strong>کد JavaScript</strong><div class="code-block">${escape(details.jsCode)}</div></div></div>
                            <div class="info-item full-width"><div><strong>کد Backend</strong><div class="code-block">${escape(details.backendCode)}</div></div></div>
                        </div>
                    </div>`;
        }

        // --- NEW: Modern Alert Functions ---
        const modal = document.getElementById('modern-alert');
        function showModernAlert(message) {
            document.getElementById('modal-icon').innerHTML = errorIcon;
            document.getElementById('modal-text').textContent = message;
            modal.classList.add('active');
        }
        function closeModernAlert() { modal.classList.remove('active'); }
        
        // Original Logout function, ENHANCED
        function logout() {
            localStorage.removeItem('projectUser'); // Clear saved session
            window.location.reload();
        }

    </script>
</body>
</html>
