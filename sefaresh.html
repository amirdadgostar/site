<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø·Ø±Ø§Ø­ÛŒ Ø³Ø§ÛŒØª | ØªÙˆâ€ŒÙˆØ¨</title>
    <!-- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ùˆ ÙÙˆÙ†Øª -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); position: relative; }
        h2 { text-align: center; color: #1f2937; margin-bottom: 20px; font-weight: 800; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #4b5563; font-weight: 500; }
        input, select { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-family: inherit; font-size: 16px; box-sizing: border-box; transition: 0.3s; }
        input:focus, select:focus { border-color: #3b82f6; outline: none; ring: 2px solid #3b82f6; }
        
        .price-box { background: #eff6ff; padding: 15px; border-radius: 8px; border: 1px solid #bfdbfe; margin: 20px 0; text-align: center; }
        .total-price { color: #2563eb; font-size: 1.5rem; font-weight: bold; }
        
        .btn { width: 100%; padding: 14px; background: #2563eb; color: white; border: none; border-radius: 10px; font-size: 1.1rem; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn:hover { background: #1d4ed8; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        
        .hidden { display: none; }
        .error { color: #ef4444; font-size: 0.85rem; margin-top: 5px; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ú©Ø³ Ú¯Ø±ÙØªÙ† */
        #contract-preview {
            position: fixed; top: -9999px; left: -9999px; /* Ù¾Ù†Ù‡Ø§Ù† Ø§Ø² Ø¯ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± ÙˆÙ„ÛŒ Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¯Ø± */
            width: 800px; background: white; padding: 40px; border: 10px solid #1f2937;
            font-family: 'Vazirmatn', sans-serif; color: #000; direction: rtl;
        }
        .contract-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
        .contract-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 1.2rem; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .watermark { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 6rem; color: rgba(255, 0, 0, 0.15); font-weight: bold; border: 5px solid rgba(255, 0, 0, 0.15); padding: 20px;
        }
        
        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        .loader { display: none; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ØµÙØ­Ù‡ Ù…ÙˆÙÙ‚ÛŒØª */
        #success-view { text-align: center; }
        .success-icon { font-size: 4rem; color: #10b981; margin-bottom: 10px; }
    </style>
</head>
<body>

    <!-- ØµÙØ­Ù‡ ÙØ±Ù… -->
    <div class="container" id="form-view">
        <h2>ÙØ±Ù… Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø·Ø±Ø§Ø­ÛŒ Ø³Ø§ÛŒØª</h2>
        <form id="orderForm">
            <div class="form-group">
                <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                <input type="text" id="fullName" required placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ">
            </div>

            <div class="form-group">
                <label>Ú©Ø¯ Ù…Ù„ÛŒ</label>
                <input type="number" id="nationalCode" required placeholder="10 Ø±Ù‚Ù… Ø¨Ø¯ÙˆÙ† Ø®Ø· ØªÛŒØ±Ù‡">
                <div id="nid-error" class="error"></div>
            </div>

            <div class="form-group">
                <label>Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù†</label>
                <select id="planType" onchange="calculatePrice()">
                    <option value="economy" data-price="1000000">Ø³Ø§ÛŒØª Ù…Ø¹Ø±ÙÛŒ Ø³Ø§Ø¯Ù‡ (Û±,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)</option>
                    <option value="connected" data-price="2000000">Ø³Ø§ÛŒØª Ù…ØªØµÙ„ Ø¨Ù‡ Ú¯ÙˆÚ¯Ù„ (Û²,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ù‚Ø§Ù„Ø¨ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ</label>
                <select id="templateName">
                    <option value="T-101">Ù‚Ø§Ù„Ø¨ Ø´Ø±Ú©ØªÛŒ Ù…Ø¯Ø±Ù† (T-101)</option>
                    <option value="T-102">Ù‚Ø§Ù„Ø¨ Ø´Ø®ØµÛŒ/Ø±Ø²ÙˆÙ…Ù‡ (T-102)</option>
                    <option value="T-103">Ù‚Ø§Ù„Ø¨ Ø®Ø¨Ø±ÛŒ Ø³Ø§Ø¯Ù‡ (T-103)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Ø¢ÛŒØ§ Ø¯Ø§Ù…Ù†Ù‡ Ø§Ø®ØªØµØ§ØµÛŒ (.ir) Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ØŸ</label>
                <select id="domainRequest" onchange="calculatePrice()">
                    <option value="no" data-price="0">Ø®ÛŒØ± (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ù…Ù†Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù†)</option>
                    <option value="yes" data-price="100000">Ø¨Ù„Ù‡ (+Û±Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†)</option>
                </select>
            </div>

            <div class="form-group">
                <label>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ø·Ø±Ø§Ø­ÛŒ</label>
                <input type="date" id="designDate" required>
                <small style="color: #6b7280; font-size: 0.8rem;">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ§ Û³Û° Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡</small>
            </div>

            <div class="price-box">
                <div>Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</div>
                <div class="total-price" id="totalPriceDisplay">1,000,000 ØªÙˆÙ…Ø§Ù†</div>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="acceptTerms" style="width: 20px;">
                    <span style="font-size: 0.9rem;">
                        Ø§ÛŒÙ†Ø¬Ø§Ù†Ø¨ ØªÙ…Ø§Ù… Ù‚ÙˆØ§Ù†ÛŒÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ (Ø§Ø¹ØªØ¨Ø§Ø± Û³ Ø±ÙˆØ²Ù‡ØŒ Ø¹Ø¯Ù… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ÙˆØ¬Ù‡ Ù¾Ø³ Ø§Ø² Ø´Ø±ÙˆØ¹ Ú©Ø§Ø± Ùˆ...) Ø±Ø§ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ø±Ø¯Ù‡ Ùˆ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ù….
                    </span>
                </label>
            </div>

            <button type="submit" class="btn" id="submitBtn" disabled>ØªØ£ÛŒÛŒØ¯ Ùˆ ØµØ¯ÙˆØ± Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</button>
            <div class="loader" id="loader"></div>
        </form>
    </div>

    <!-- ØµÙØ­Ù‡ Ù†Ù‡Ø§ÛŒÛŒ -->
    <div class="container hidden" id="success-view">
        <div class="success-icon">âœ”</div>
        <h2 style="color: #10b981;">Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø«Ø¨Øª Ø´Ø¯</h2>
        <p>Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒØŒ Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Ø³Ø§Ù…Ø§Ù†Ù‡ Ø±Ø²Ø±Ùˆ Ø´Ø¯.</p>
        <p style="background: #fffbeb; padding: 10px; border: 1px solid #fcd34d; border-radius: 5px; font-size: 0.9rem;">
            âš ï¸ ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ ØªØ§ ØªØ§Ø±ÛŒØ® <strong id="expireDateDisplay"></strong> Ø§Ø¹ØªØ¨Ø§Ø± Ø¯Ø§Ø±Ø¯.
        </p>
        
        <button class="btn" id="downloadContractBtn" style="background: #1f2937; margin-top: 15px;">
            ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        </button>

        <p style="margin-top: 20px; font-size: 0.9rem; color: #4b5563;">
            Ù„Ø·ÙØ§ ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ù‡Ù…Ø±Ø§Ù‡ ÙÛŒØ´ ÙˆØ§Ø±ÛŒØ²ÛŒ Ø¨Ù‡ Ø¢ÛŒØ¯ÛŒ Ø§ÛŒØªØ§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.
        </p>
        <div style="margin-top: 15px; font-weight: bold;">
            Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª: <span style="font-family: monospace; font-size: 1.1rem;">6063-7311-3256-0120</span><br>
            Ø¨Ù‡ Ù†Ø§Ù… Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ø¯Ø§Ø¯Ú¯Ø³ØªØ±
        </div>
    </div>

    <!-- Ù‚Ø§Ù„Ø¨ Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø¹Ú©Ø³ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ -->
    <div id="contract-preview">
        <div class="watermark">ÙØ§Ù‚Ø¯ Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ù¾Ø±Ø¯Ø§Ø®Øª</div>
        <div class="contract-header">
            <h1>Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø·Ø±Ø§Ø­ÛŒ Ø³Ø§ÛŒØª | ØªÙˆâ€ŒÙˆØ¨</h1>
            <p>Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´: <span id="c-orderId"></span></p>
            <p>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: <span id="c-date"></span></p>
        </div>
        <div style="padding: 0 50px;">
            <div class="contract-row"><span>Ù†Ø§Ù… Ú©Ø§Ø±ÙØ±Ù…Ø§:</span> <span id="c-name"></span></div>
            <div class="contract-row"><span>Ú©Ø¯ Ù…Ù„ÛŒ:</span> <span id="c-nid"></span></div>
            <div class="contract-row"><span>Ù†ÙˆØ¹ Ù¾Ù„Ù†:</span> <span id="c-plan"></span></div>
            <div class="contract-row"><span>Ù‚Ø§Ù„Ø¨ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</span> <span id="c-template"></span></div>
            <div class="contract-row"><span>ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ù…Ù†Ù‡:</span> <span id="c-domain"></span></div>
            <div class="contract-row"><span>ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡:</span> <span id="c-start"></span></div>
            <div class="contract-row" style="border-bottom: 2px solid #000; font-weight: bold; margin-top: 30px;">
                <span>Ù…Ø¨Ù„Øº Ú©Ù„:</span> <span id="c-total"></span>
            </div>
            <div style="margin-top: 40px; text-align: center; font-size: 0.9rem; color: #555;">
                <p>Ø§ÛŒÙ† Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©ÛŒ Ø¯Ø± Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ù…Ù†Ø²Ù„Ù‡ Ø³Ù†Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ø§Ø³Øª.</p>
                <p>Ù…Ù‡Ù„Øª Ù¾Ø±Ø¯Ø§Ø®Øª: Ø­Ø¯Ø§Ú©Ø«Ø± Û·Û² Ø³Ø§Ø¹Øª Ù¾Ø³ Ø§Ø² ØµØ¯ÙˆØ±.</p>
                <p>Ø·Ø±Ø§Ø­: Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ø¯Ø§Ø¯Ú¯Ø³ØªØ±</p>
            </div>
        </div>
    </div>

    <script>
        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        // Ù„ÛŒÙ†Ú© Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ (Ù…Ø±Ø­Ù„Ù‡ Û²)
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwYt2ZDN1BWuvJa-_vAmFVopFHJTjyd5DY2pAVy1hTIIcfQsNeSm1xInmMPb05MgpXy/exec"; 
        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ†ÛŒÙ…Ù… Ùˆ Ù…Ø§Ú©Ø³ÛŒÙ…Ù…
        const dateInput = document.getElementById('designDate');
        const today = new Date();
        const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1);
        const maxDate = new Date(today); maxDate.setDate(maxDate.getDate() + 30);
        
        dateInput.min = tomorrow.toISOString().split('T')[0];
        dateInput.max = maxDate.toISOString().split('T')[0];

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª
        function calculatePrice() {
            const planPrice = parseInt(document.getElementById('planType').selectedOptions[0].dataset.price);
            const domainPrice = parseInt(document.getElementById('domainRequest').selectedOptions[0].dataset.price);
            const total = planPrice + domainPrice;
            document.getElementById('totalPriceDisplay').innerText = total.toLocaleString() + " ØªÙˆÙ…Ø§Ù†";
            return { planPrice, domainPrice, total };
        }

        // ÙØ¹Ø§Ù„ Ø³Ø§Ø²ÛŒ Ø¯Ú©Ù…Ù‡
        document.getElementById('acceptTerms').addEventListener('change', function() {
            document.getElementById('submitBtn').disabled = !this.checked;
        });

        // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ù…Ù„ÛŒ
        function isValidIranianNationalCode(input) {
            if (!/^\d{10}$/.test(input)) return false;
            const check = +input[9];
            const sum = input.split('').slice(0, 9).reduce((acc, x, i) => acc + +x * (10 - i), 0) % 11;
            return sum < 2 ? check === sum : check + sum === 11;
        }

        document.getElementById('nationalCode').addEventListener('blur', function() {
            if(!isValidIranianNationalCode(this.value)) {
                document.getElementById('nid-error').innerText = "Ú©Ø¯ Ù…Ù„ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª";
                document.getElementById('submitBtn').disabled = true;
            } else {
                document.getElementById('nid-error').innerText = "";
                if(document.getElementById('acceptTerms').checked) document.getElementById('submitBtn').disabled = false;
            }
        });

        // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            
            btn.classList.add('hidden');
            loader.style.display = 'block';

            const prices = calculatePrice();
            const formData = {
                fullName: document.getElementById('fullName').value,
                nationalCode: document.getElementById('nationalCode').value,
                planType: document.getElementById('planType').options[document.getElementById('planType').selectedIndex].text,
                planPrice: prices.planPrice,
                templateName: document.getElementById('templateName').value,
                domainRequest: document.getElementById('domainRequest').value === 'yes' ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                domainPrice: prices.domainPrice,
                totalPrice: prices.total,
                designDate: document.getElementById('designDate').value
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();

                if(result.success) {
                    // Ø¢Ù…Ø§Ø¯Ù‡ Ø³Ø§Ø²ÛŒ Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¹Ú©Ø³
                    document.getElementById('c-orderId').innerText = result.orderId;
                    document.getElementById('c-date').innerText = new Date().toLocaleDateString('fa-IR');
                    document.getElementById('c-name').innerText = formData.fullName;
                    document.getElementById('c-nid').innerText = formData.nationalCode;
                    document.getElementById('c-plan').innerText = formData.planType;
                    document.getElementById('c-template').innerText = formData.templateName;
                    document.getElementById('c-domain').innerText = formData.domainRequest;
                    document.getElementById('c-start').innerText = formData.designDate;
                    document.getElementById('c-total').innerText = formData.totalPrice.toLocaleString() + " ØªÙˆÙ…Ø§Ù†";
                    
                    document.getElementById('expireDateDisplay').innerText = result.expireDate;

                    document.getElementById('form-view').classList.add('hidden');
                    document.getElementById('success-view').classList.remove('hidden');
                } else {
                    alert("Ø®Ø·Ø§: " + result.message);
                    btn.classList.remove('hidden');
                    loader.style.display = 'none';
                }
            } catch (error) {
                alert("Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
                console.error(error);
                btn.classList.remove('hidden');
                loader.style.display = 'none';
            }
        });

        // Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯
        document.getElementById('downloadContractBtn').addEventListener('click', function() {
            const element = document.getElementById('contract-preview');
            html2canvas(element).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Contract-' + document.getElementById('c-orderId').innerText + '.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });
    </script>
</body>
</html>
