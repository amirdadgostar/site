<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุงูุงูู ุซุจุช ูุฑุงุฑุฏุงุฏ ุทุฑุงุญ ุณุงุช</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas ุจุฑุง ุนฺฉุณ ฺฏุฑูุชู ุงุฒ ูุฑุงุฑุฏุงุฏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- ูููุช ูุฒุฑูุชู -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; }
        .hidden-step { display: none; }
        .contract-paper {
            background: white;
            width: 800px; /* ุณุงุฒ A4 ุชูุฑุจ ุจุฑุง ุนฺฉุณ */
            padding: 40px;
            border: 1px solid #ccc;
            position: relative;
            margin: 0 auto;
        }
        .watermark {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 80px;
            color: rgba(255, 0, 0, 0.1);
            font-weight: bold;
            pointer-events: none;
            z-index: 10;
            border: 5px solid rgba(255,0,0,0.1);
            padding: 10px 40px;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- ฺฉุงููฺฏ -->
    <script>
        // *** ููฺฉ ุงุณฺฉุฑูพุช ุฎูุฏ ุฑุง ุงูุฌุง ุจฺฏุฐุงุฑุฏ ***
        const APP_SCRIPT_URL = "YOUR_WEB_APP_URL_GOES_HERE"; 
    </script>

    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        
        <!-- ูุฏุฑ -->
        <div class="bg-blue-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold mb-2">ุณุงูุงูู ุนูุฏ ูุฑุงุฑุฏุงุฏ ุทุฑุงุญ ุณุงุช</h1>
            <p class="text-sm opacity-90">ูุณุฎู ููุง - ุงูุฑุญุณู ุฏุงุฏฺฏุณุชุฑ</p>
        </div>

        <!-- ููุฏูฺฏ -->
        <div id="loading" class="p-10 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p>ุฏุฑ ุญุงู ุฏุฑุงูุช ุงุทูุงุนุงุช ู ุธุฑูุชโูุง...</p>
        </div>

        <!-- ูุฑุญูู 1: ูุฑู ุงุทูุงุนุงุช -->
        <div id="step-form" class="p-6 hidden-step">
            <form id="orderForm" onsubmit="handlePreview(event)">
                
                <div class="grid gap-6 mb-6">
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900">ูุงู ู ูุงู ุฎุงููุงุฏฺฏ</label>
                        <input type="text" id="fullName" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                    </div>
                    
                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900">ฺฉุฏ ูู</label>
                        <input type="number" id="nationalCode" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="10 ุฑูู ุจุฏูู ุฎุท ุชุฑู">
                        <p id="ncError" class="text-red-500 text-xs mt-1 hidden">ฺฉุฏ ูู ูุนุชุจุฑ ูุณุช</p>
                    </div>

                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900">ุงูุชุฎุงุจ ูพูู</label>
                        <select id="planType" onchange="calcPrice()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="type1" data-price="1000000">ููุน ฑ: ุณุงุช ูุนุฑู ุณุงุฏู (ฑ,ฐฐฐ,ฐฐฐ ุชููุงู)</option>
                            <option value="type2" data-price="2000000">ููุน ฒ: ุณุงุช ูุชุตู ุจู ฺฏูฺฏู (ฒ,ฐฐฐ,ฐฐฐ ุชููุงู)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900">ูุงูุจ ุงูุชุฎุงุจ</label>
                        <select id="templateName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="Minimal_Blue">ูููุงู ุขุจ</option>
                            <option value="Modern_Dark">ูุฏุฑู ุชุฑู</option>
                            <option value="Corporate_Gold">ุดุฑฺฉุช ุทูุง</option>
                            <option value="Personal_VCard">ฺฉุงุฑุช ูุฒุช ุดุฎุต</option>
                        </select>
                    </div>

                    <div class="border p-4 rounded-lg bg-gray-50">
                        <div class="flex items-center mb-2">
                            <input id="domainRequest" type="checkbox" onchange="toggleDomain()" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded">
                            <label for="domainRequest" class="mr-2 text-sm font-medium text-gray-900">ุฏุฑุฎูุงุณุช ุฎุฑุฏ ุฏุงููู ู ุงุชุตุงู ุฏุงุฑู (+ฑฐฐ,ฐฐฐ ุชููุงู)</label>
                        </div>
                        <div id="domainInputBox" class="hidden mt-2">
                            <label class="block mb-1 text-xs text-gray-600">ูุงู ุฏุงููู ูพุดููุงุฏ (ุจู ุงูฺฏูุณ)</label>
                            <input type="text" id="domainName" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2" placeholder="example.ir">
                        </div>
                    </div>

                    <div>
                        <label class="block mb-2 text-sm font-medium text-gray-900">ุชุงุฑุฎ ุดุฑูุน ุทุฑุงุญ</label>
                        <select id="startDate" required class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                            <option value="">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ ุชุงุฑุฎโูุง...</option>
                        </select>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg mb-6 text-center">
                    <span class="text-gray-700 text-sm">ูุจูุบ ููุง ูุงุจู ูพุฑุฏุงุฎุช:</span>
                    <div class="text-2xl font-bold text-blue-700 mt-1"><span id="totalPriceDisplay">1,000,000</span> ุชููุงู</div>
                </div>

                <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-lg w-full px-5 py-3 text-center">ูุดุงูุฏู ู ุชุฃุฏ ูุฑุงุฑุฏุงุฏ</button>
            </form>
        </div>

        <!-- ูุฑุญูู 2: ูพุดโููุงุด ู ุงูุถุง -->
        <div id="step-preview" class="p-6 hidden-step bg-gray-100">
            <h3 class="text-xl font-bold mb-4 text-center">ูพุดโููุงุด ูุฑุงุฑุฏุงุฏ</h3>
            <p class="text-sm text-center text-gray-500 mb-4">ูุทูุงู ููุงุฏ ูุฑุงุฑุฏุงุฏ ุฑุง ูุทุงูุนู ู ุณูพุณ ุฏฺฉูู ุชุฃุฏ ุฑุง ุจุฒูุฏ.</p>
            
            <!-- ฺฉุงูุชูุฑ ูุฑุงุฑุฏุงุฏ ุจุฑุง ุนฺฉุณ ฺฏุฑูุชู -->
            <div style="overflow-x: auto;">
                <div id="contract-capture" class="contract-paper text-sm leading-6 text-justify" dir="rtl">
                    <div class="watermark">ูุงูุฏ ุงุนุชุจุงุฑ ุจุฏูู ูพุฑุฏุงุฎุช</div>
                    
                    <div class="text-center border-b-2 border-black pb-2 mb-4">
                        <h2 class="text-xl font-bold">ูุฑุงุฑุฏุงุฏ ุทุฑุงุญ ุณุงุช (ุบุฑ ุญุถูุฑ)</h2>
                        <span class="text-xs text-gray-500">ุดูุงุณู: <span id="c_orderId">---</span></span> | 
                        <span class="text-xs text-gray-500">ุชุงุฑุฎ: <span id="c_date">---</span></span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4 bg-gray-50 p-2 border rounded">
                        <div><strong>ฺฉุงุฑูุฑูุง:</strong> <span id="c_name"></span></div>
                        <div><strong>ฺฉุฏ ูู:</strong> <span id="c_national"></span></div>
                        <div><strong>ููุน ูพูู:</strong> <span id="c_plan"></span></div>
                        <div><strong>ูุงูุจ:</strong> <span id="c_template"></span></div>
                        <div><strong>ุฏุงููู ุงุฎุชุตุงุต:</strong> <span id="c_domain"></span></div>
                        <div><strong>ุชุงุฑุฎ ุดุฑูุน:</strong> <span id="c_start"></span></div>
                    </div>

                    <div class="mb-4">
                        <h4 class="font-bold border-b inline-block mb-1">ูุงุฏู ฑ: ููุถูุน ูุฑุงุฑุฏุงุฏ</h4>
                        <p>ุทุฑุงุญ ู ุฑุงูโุงูุฏุงุฒ ูุจโุณุงุช ุงุณุชุงุชฺฉ ุจุฑ ุจุณุชุฑ GitHub Pages ุจุง ูุดุฎุตุงุช ููู.</p>
                        
                        <h4 class="font-bold border-b inline-block mb-1 mt-2">ูุงุฏู ฒ: ูุจูุบ ู ูพุฑุฏุงุฎุช</h4>
                        <p>ูุจูุบ ฺฉู ูุฑุงุฑุฏุงุฏ <strong><span id="c_price"></span> ุชููุงู</strong> ูโุจุงุดุฏ.</p>
                        <ul class="list-disc pr-5 text-xs text-gray-700 mt-1">
                            <li>ูพุฑุฏุงุฎุช ฺฉุงูู (ฺฉุฌุง) ุง ุฏู ูุฑุญููโุง (ตฐูช ุดุฑูุนุ ตฐูช ุชุญูู) ุงูฺฉุงูโูพุฐุฑ ุงุณุช.</li>
                            <li>ูุงุฑุฒ ุจู ฺฉุงุฑุช: <strong>6063-7311-3256-0120</strong> ุจู ูุงู ุงูุฑุญุณู ุฏุงุฏฺฏุณุชุฑ.</li>
                        </ul>

                        <h4 class="font-bold border-b inline-block mb-1 mt-2">ูุงุฏู ณ: ุชุนูุฏุงุช ู ููุงูู</h4>
                        <ol class="list-decimal pr-5 text-xs text-gray-700 space-y-1">
                            <li><strong>ุงุนุชุจุงุฑ:</strong> ุงู ูุฑุงุฑุฏุงุฏ ุชููุง ณ ุฑูุฒ ุงุนุชุจุงุฑ ุฏุงุฑุฏ ู ุฏุฑ ุตูุฑุช ุนุฏู ูุงุฑุฒุ ุจุงุทู ุงุณุช.</li>
                            <li><strong>ุชุงุฏ ููุง:</strong> ุงุฑุณุงู ูุด ุตุฑูุงู ุงุนูุงู ูพุฑุฏุงุฎุช ุงุณุช ู ุดุฑูุน ูพุฑูฺู ูููุท ุจู ุชุฃุฏ ุทุฑุงุญ ุฏุฑ ุณุงูุงูู ุงุณุช.</li>
                            <li><strong>ุชุบุฑุงุช:</strong> ุชุบุฑ ูุงูุจ ูพุณ ุงุฒ ุซุจุชุ ุงูฺฉุงูโูพุฐุฑ ูุณุช. ุงูฺฉุงูุงุช ุฎุงุฑุฌ ุงุฒ ูพูู ูุฒูู ุฌุฏุง ุฏุงุฑุฏ.</li>
                            <li><strong>ุฏุงููู:</strong> ุฏุฑ ุตูุฑุช ุฎุฑุฏ ุฏุงููู IRุ ุซุจุชโูุงู ุฏุฑ ุงุฑูฺฉ ุธุฑู ฑฐ ุฑูุฒ ุจุฑ ุนูุฏู ฺฉุงุฑูุฑูุงุณุช.</li>
                            <li><strong>ูพุดุชุจุงู:</strong> ฑฐ ุฑูุฒ ูพุณ ุงุฒ ุชุญููุ ุดุงูู ุฑูุน ุงุฑุงุฏุงุช ูู ุทุฑุงุญ.</li>
                            <li><strong>ุณูุจ ูุณุฆููุช:</strong> ุณุงุชโูุง ูุฑูุดฺฏุงู ูุณุชูุฏ ู ุฑุชุจู ฺฏูฺฏู ุชุถูู ููโุดูุฏ.</li>
                        </ol>
                    </div>

                    <div class="mt-6 pt-4 border-t-2 border-black flex justify-between items-center">
                        <div class="text-center w-1/2">
                            <p class="font-bold">ุทุฑุงุญ</p>
                            <p class="text-sm mt-2">ุงูุฑุญุณู ุฏุงุฏฺฏุณุชุฑ</p>
                            <p class="text-xs text-gray-400">(ุงูุถุง ุณุณุชู)</p>
                        </div>
                        <div class="text-center w-1/2">
                            <p class="font-bold">ฺฉุงุฑูุฑูุง</p>
                            <p class="text-sm mt-2" id="c_name_sign"></p>
                            <p class="text-xs text-blue-600 font-bold bg-blue-100 inline-block px-2 rounded mt-1">ุชุฃุฏ ุงูฺฉุชุฑููฺฉ ุดุฏ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ุฏฺฉููโูุง ุชุฃุฏ -->
            <div class="mt-6 bg-white p-4 rounded shadow">
                <div class="flex items-center mb-4">
                    <input id="agreeCheck" type="checkbox" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="agreeCheck" class="mr-2 text-sm font-medium text-gray-900">ุชูุงู ููุงุฏ ูุฑุงุฑุฏุงุฏ ุฑุง ูุทุงูุนู ฺฉุฑุฏู ู ูโูพุฐุฑู. ฺฉูฺฉ ุฑู ุฏฺฉูู ุฒุฑ ุจู ููุฒูู ุงูุถุง ุงุณุช.</label>
                </div>
                
                <div class="flex gap-4">
                    <button onclick="goBack()" class="w-1/3 text-gray-700 bg-gray-200 hover:bg-gray-300 font-medium rounded-lg px-5 py-2.5">ุจุงุฒฺฏุดุช ู ุงุตูุงุญ</button>
                    <button onclick="submitContract()" id="btnSubmit" disabled class="w-2/3 text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 font-medium rounded-lg px-5 py-2.5">ุชุฃุฏ ููุง ู ุซุจุช ุณูุงุฑุด</button>
                </div>
                <p id="submitMsg" class="text-center mt-2 text-sm text-blue-600 hidden">ุฏุฑ ุญุงู ุซุจุช ุงุทูุงุนุงุช ู ุงุฌุงุฏ ุชุตูุฑ... ูุทูุงู ุตุจุฑ ฺฉูุฏ...</p>
            </div>
        </div>

        <!-- ูุฑุญูู 3: ููููุช -->
        <div id="step-success" class="p-8 hidden-step text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">โ</div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">ุณูุงุฑุด ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ!</h2>
            <p class="text-gray-600 mb-6">ูุฑุงุฑุฏุงุฏ ุดูุง ูููุชุงู ุซุจุช ุดุฏ. ูุทูุงู ุจุฑุง ููุง ุดุฏูุ ุชุตูุฑ ูุฑุงุฑุฏุงุฏ ุฑุง ุฏุงูููุฏ ฺฉุฑุฏู ู ููุฑุงู ูุด ูุงุฑุฒ ุงุฑุณุงู ฺฉูุฏ.</p>
            
            <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg mb-6 text-sm text-yellow-800">
                <p>โณ <strong>ูููุช ูพุฑุฏุงุฎุช:</strong> ุชุง <span id="expireDateDisplay" class="font-bold"></span></p>
                <p>๐ณ <strong>ุดูุงุฑู ฺฉุงุฑุช:</strong> 6063-7311-3256-0120</p>
            </div>

            <a id="downloadLink" href="#" download="contract.png" class="block w-full text-white bg-blue-700 hover:bg-blue-800 font-bold rounded-lg px-5 py-4 mb-3 shadow-lg flex justify-center items-center gap-2">
                <span>๐ฅ ุฏุงูููุฏ ุชุตูุฑ ูุฑุงุฑุฏุงุฏ</span>
            </a>
            
            <a href="https://eitaa.com/YOUR_EITAA_ID" class="block w-full text-blue-700 bg-blue-100 hover:bg-blue-200 font-bold rounded-lg px-5 py-3">
                ุงุฑุณุงู ูุด ุฏุฑ ุงุชุง
            </a>
        </div>

    </div>

    <script>
        // --- Logic ---
        let formData = {};

        // 1. Load Dates on Start
        window.onload = function() {
            if(APP_SCRIPT_URL === "https://script.google.com/macros/s/AKfycbxVkozAAKm-QZqLt14u3irfG-ojLUvcRjt5CTv0n4HVy1tIXb-R86F-xJu8W_V7WV2W/exec"){
                alert("ูุทูุง ููฺฉ ูุจโุงูพ ุงุณฺฉุฑูพุช ุฑุง ุฏุฑ ูุงู HTML ุฌุงฺฏุฒู ฺฉูุฏ!");
                return;
            }

            fetch(APP_SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('startDate');
                select.innerHTML = '<option value="">ุงูุชุฎุงุจ ฺฉูุฏ...</option>';
                if(data.dates && data.dates.length > 0) {
                    data.dates.forEach(d => {
                        let opt = document.createElement('option');
                        opt.value = d.value;
                        opt.text = d.label;
                        select.add(opt);
                    });
                } else {
                    select.innerHTML = '<option>ูฺ ุธุฑูุช ุฎุงู ูุฌูุฏ ูุฏุงุฑุฏ</option>';
                }
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('step-form').classList.remove('hidden-step');
            })
            .catch(err => {
                alert("ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ");
                console.error(err);
            });
        };

        // Price Calc
        function toggleDomain() {
            const chk = document.getElementById('domainRequest');
            const box = document.getElementById('domainInputBox');
            box.classList.toggle('hidden', !chk.checked);
            calcPrice();
        }

        function calcPrice() {
            const planSelect = document.getElementById('planType');
            const planPrice = parseInt(planSelect.options[planSelect.selectedIndex].dataset.price);
            const hasDomain = document.getElementById('domainRequest').checked;
            const domainPrice = hasDomain ? 100000 : 0;
            
            const total = planPrice + domainPrice;
            document.getElementById('totalPriceDisplay').innerText = total.toLocaleString();
            return { planPrice, domainPrice, total };
        }

        // Validate National Code
        function isValidIranianNationalCode(input) {
            if (!/^\d{10}$/.test(input)) return false;
            const check = +input[9];
            const sum = input.split('').slice(0, 9).reduce((acc, x, i) => acc + +x * (10 - i), 0) % 11;
            return sum < 2 ? check === sum : check + sum === 11;
        }

        // Form Submit -> Preview
        function handlePreview(e) {
            e.preventDefault();
            
            const nc = document.getElementById('nationalCode').value;
            if(!isValidIranianNationalCode(nc)){
                document.getElementById('ncError').classList.remove('hidden');
                return;
            }
            document.getElementById('ncError').classList.add('hidden');

            const prices = calcPrice();
            
            // Save Data
            formData = {
                fullName: document.getElementById('fullName').value,
                nationalCode: nc,
                planType: document.getElementById('planType').options[document.getElementById('planType').selectedIndex].text,
                planPrice: prices.planPrice,
                templateName: document.getElementById('templateName').value,
                domainRequest: document.getElementById('domainRequest').checked,
                domainName: document.getElementById('domainName').value,
                domainPrice: prices.domainPrice,
                totalPrice: prices.total,
                startDate: document.getElementById('startDate').value,
                startDateLabel: document.getElementById('startDate').options[document.getElementById('startDate').selectedIndex].text.split('(')[0]
            };

            // Fill Preview
            document.getElementById('c_name').innerText = formData.fullName;
            document.getElementById('c_national').innerText = formData.nationalCode;
            document.getElementById('c_plan').innerText = formData.planType.split(':')[0];
            document.getElementById('c_template').innerText = formData.templateName;
            document.getElementById('c_domain').innerText = formData.domainRequest ? (formData.domainName || "ุจูู") : "ุฎุฑ";
            document.getElementById('c_start').innerText = formData.startDateLabel;
            document.getElementById('c_price').innerText = formData.totalPrice.toLocaleString();
            document.getElementById('c_name_sign').innerText = formData.fullName;
            document.getElementById('c_date').innerText = new Intl.DateTimeFormat('fa-IR').format(new Date());
            document.getElementById('c_orderId').innerText = "ุฏุฑ ุญุงู ุชููุฏ...";

            // Show Step 2
            document.getElementById('step-form').classList.add('hidden-step');
            document.getElementById('step-preview').classList.remove('hidden-step');
            window.scrollTo(0,0);
        }

        function goBack() {
            document.getElementById('step-preview').classList.add('hidden-step');
            document.getElementById('step-form').classList.remove('hidden-step');
        }

        // Checkbox Logic
        document.getElementById('agreeCheck').addEventListener('change', function() {
            document.getElementById('btnSubmit').disabled = !this.checked;
        });

        // Submit to Google Sheets
        function submitContract() {
            document.getElementById('btnSubmit').disabled = true;
            document.getElementById('submitMsg').classList.remove('hidden');
            
            // Send to Script
            fetch(APP_SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(response => {
                if(response.status === 'success') {
                    // Update Order ID in contract view for image
                    document.getElementById('c_orderId').innerText = response.orderId;
                    document.getElementById('expireDateDisplay').innerText = response.expireDate;

                    // Generate Image
                    generateImage();
                } else {
                    alert("ุฎุทุง: " + response.message);
                    document.getElementById('btnSubmit').disabled = false;
                    document.getElementById('submitMsg').classList.add('hidden');
                }
            })
            .catch(err => {
                alert("ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุดุจฺฉู!");
                console.error(err);
                document.getElementById('btnSubmit').disabled = false;
            });
        }

        function generateImage() {
            const element = document.getElementById('contract-capture');
            
            html2canvas(element, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL("image/png");
                
                // Set download link
                const link = document.getElementById('downloadLink');
                link.href = imgData;
                link.download = `Contract-${formData.nationalCode}.png`;
                
                // Show Success Step
                document.getElementById('step-preview').classList.add('hidden-step');
                document.getElementById('step-success').classList.remove('hidden-step');
            });
        }

    </script>
</body>
</html>
